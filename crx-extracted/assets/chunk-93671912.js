import{l as d,s as g,a as h,g as u,b as f,r as p}from"./chunk-cdf2dc81.js";import"./chunk-936fa2ae.js";const C="/assets/index.ts-loader-7fda2deb.js",y=["dpfkgaedamhcmkkgeiajeggihmfjhhlj","plaobjkecadfmaglmhdaolohmckjgnom"];d.extensionInitialize();var m;const l=parseInt(((m=navigator.userAgent.toLowerCase().match(/chrome\/(\d+)/))==null?void 0:m[1])||"0",10);chrome.runtime.onInstalled.addListener(()=>{g("clientId",self.crypto.randomUUID())});chrome.action.onClicked.addListener(()=>{chrome.tabs.create({url:chrome.runtime.getURL("chatHub.html")})});function w(a){const i=[],t=(e,r)=>{const o={action:{type:"modifyHeaders",requestHeaders:[{header:"Sec-Fetch-Dest",operation:"set",value:"document"},{header:"Sec-Fetch-Site",operation:"set",value:"same-origin"}],responseHeaders:[{header:"X-Frame-Options",operation:"remove"},{header:"Content-Security-Policy",operation:"remove"}]},condition:{initiatorDomains:e,...r?{resourceTypes:r}:{}}};return l!==0&&l<101&&(o.condition.domains=o.condition.initiatorDomains,delete o.condition.initiatorDomains),o};return i.push(t(y)),i.push(t(a.map(e=>new URL(e.url).hostname),["sub_frame"])),a.forEach(e=>{var r;(r=e.networkRules)==null||r.forEach(o=>{i.push(o)})}),i.map((e,r)=>({...e,id:r+1,priority:1}))}async function s(){const a=await u(),i=w(a),e=(await chrome.declarativeNetRequest.getDynamicRules()).map(r=>r.id);await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:e,addRules:i})}let n=!1;async function c(){if(!n)try{n=!0;const i=(await u()).map(t=>t.url+"*");try{const t=await chrome.scripting.getRegisteredContentScripts();if(t.length>0){const e=t.map(r=>r.id);await chrome.scripting.unregisterContentScripts({ids:e})}}catch(t){console.error("[Background] Failed to unregister old scripts:",t)}await chrome.scripting.registerContentScripts([{id:"main-content-script",matches:i,js:[C],allFrames:!0,runAt:"document_idle"},{id:"claude-main-world",matches:["https://claude.ai/*","https://*.claude.ai/*"],js:["assets/claude-main.js"],allFrames:!0,runAt:"document_start",world:"MAIN"}])}finally{n=!1}}(async function(){await Promise.all([s(),c()])})();h(async(a,i,t)=>{if(a==="reloadConfigs"){try{await Promise.all([s(),c()]),t({success:!0})}catch(e){console.error("[Background] Failed to reload config:",e),t({success:!1,error:e.message})}return!0}if(a==="getConfigInfo"){try{const e=await f();t(e)}catch(e){t({error:e.message})}return!0}if(a==="resetConfig"){try{await p(),await Promise.all([s(),c()]),t({success:!0,message:"Reset to builtin config"})}catch(e){t({success:!1,error:e.message})}return!0}});
