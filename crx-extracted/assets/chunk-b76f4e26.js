import{A as E}from"./chunk-936fa2ae.js";import{d as f,b as A,k as u,l as S,t as p,m as C,n as b,q as k,u as x,v as P}from"./chunk-a783bd53.js";class d{static async executeAction(t){switch(t.type){case"clickButtonByText":await this.clickButtonByText(t.params.text);break;case"findAndSetDataId":await this.findAndSetDataId(t.params.selector,t.params.dataId);break;case"findAndSetParentDataId":await this.findAndSetParentDataId(t.params.selector,t.params.dataId);break;case"waitForElement":await this.waitForElement(t.params.selector,t.params.timeout);break;case"wait":await this.wait(t.params.duration);break;case"triggerClick":await this.triggerClick(t.params.selector);break;case"ensureSidebarOpen":await this.ensureSidebarOpen(t.params);break;case"delay":console.warn("Custom action not implemented:",t.params);break;default:console.warn("Unknown action type:",t.type)}}static async executeActions(t){for(const n of t)await this.executeAction(n)}static async clickButtonByText(t){const n=document.querySelectorAll("button"),i=Array.from(n).find(s=>{var c;return(c=s.textContent)==null?void 0:c.includes(t)});i&&i.click()}static async findAndSetDataId(t,n){for(const i of typeof t=="string"?[t]:t){const s=document.querySelector(i);if(s){s.setAttribute("data-id",n);break}}}static async findAndSetParentDataId(t,n){for(const i of typeof t=="string"?[t]:t){const s=document.querySelector(i);if(s&&s.parentElement){s.parentElement.setAttribute("data-id",n);break}}}static async waitForElement(t,n=5e3){return new Promise(i=>{const s=Date.now(),c=()=>{const r=document.querySelector(t);if(r){i(r);return}if(Date.now()-s>n){i(null);return}setTimeout(c,200)};c()})}static async wait(t){await f(t)}static async triggerClick(t){const n=document.querySelector(t);n&&n.click()}static async ensureSidebarOpen(t){const n=p=>{if(!p)return null;if(Array.isArray(p)){for(const y of p){const g=document.querySelector(y);if(g)return g}return null}return document.querySelector(p)},r=t==null?void 0:t.toggleSelector,o=t==null?void 0:t.sidebarSelector,i=(t==null?void 0:t.minWidth)??200,a=(t==null?void 0:t.interval)??200,s=(t==null?void 0:t.maxAttempts)??10,l=t==null?void 0:t.forceCss,u=(t==null?void 0:t.cssId)??"sch-sidebar-style",f=(t==null?void 0:t.keepInterval)??0,d=(t==null?void 0:t.keepDuration)??0,h=(t==null?void 0:t.intervalKey)??"__SCH_SIDEBAR_INTERVAL",v=(t==null?void 0:t.parentDepth)??2,m=(t==null?void 0:t.observerKey)??"__SCH_SIDEBAR_OBS",b=(t==null?void 0:t.cssVars)??["--sidebar-width","--sidebar-collapsed-width","--sidebarCollapsedWidth","--sidebar-size","--sidebarSize"];if(l){const p=document.getElementById(u);if(!p){const y=document.createElement("style");y.id=u,y.textContent=l,(document.head||document.documentElement||document.body).appendChild(y)}}const C=(p,y,E)=>{if(!p)return;const g=i+"px",w=p.getBoundingClientRect();if(E||w.width<i){p.style.setProperty("width",g,"important"),p.style.setProperty("min-width",g,"important"),p.style.setProperty("max-width",g,"important"),p.style.setProperty("flex","0 0 "+g,"important"),p.style.setProperty("left","0","important"),p.style.setProperty("right","auto","important"),p.style.setProperty("transform","translateX(0)","important"),p.style.setProperty("opacity","1","important"),p.style.setProperty("visibility","visible","important"),p.style.setProperty("pointer-events","auto","important")}if(y){const k=globalThis.getComputedStyle?getComputedStyle(p):null;(!k||k.display==="none")&&p.style.setProperty("display","flex","important")}};const x=async()=>{if(b&&b.length){const k=document.documentElement||document.body;if(k){const g=i+"px";for(const w of b)k.style.setProperty(w,g,"important")}}const p=n(o)||n(["nav[aria-label='Sidebar']",".z-sidebar"]);if(p){C(p,!0,!0);let y=p.parentElement;for(let g=0;g<v&&y;g++){C(y,!0,!1),y=y.parentElement}}const w=p?p.getBoundingClientRect().width:0;if(p&&w>=i)return!0;const k=n(r)||n(["[data-testid='pin-sidebar-toggle']","button[aria-label='Open sidebar']"]);k&&k.click();return!1};for(let p=0;p<s;p++){if(await x())break;await this.wait(a)}if(f){const p=globalThis[h];p&&clearInterval(p);const y=Date.now(),g=setInterval(()=>{if(d&&Date.now()-y>d){clearInterval(g),globalThis[h]=null;return}x()},f);globalThis[h]=g}if(typeof MutationObserver!=="undefined"&&!globalThis[m]){const p=()=>{x()};const y=new MutationObserver(()=>{p()});y.observe(document.documentElement||document.body,{childList:!0,subtree:!0,attributes:!0});globalThis[m]=y}}}const T=["div[contenteditable]","textarea"];let o=null;async function I(){try{o=await u("getConfig")}catch(e){console.error("[ContentScript] Failed to get config from ChatHub:",e)}}const a={};function y(e){let t=null;if(typeof e=="string")e!==""&&(t=document.querySelector(e));else if(e&&typeof e=="object")if(e.inShadowDom){const n=e.shadowRootSelector?document.querySelector(e.shadowRootSelector):void 0;t=P(e.selector,n)}else t=document.querySelector(e.selector);return t}function w(e){if(e!==void 0)return y(e);for(const t of T){const n=document.querySelector(t);if(n)return n}return null}async function q(){if(await I(),!o){console.error("Cannot initialize: no config found");return}const e=async()=>{if(!o)return;if(w(o.inputSelector)){if(o.readyActions)try{await d.executeActions(o.readyActions)}catch(n){console.warn("Ready actions failed:",n)}u("contentReady")}else setTimeout(e,200)};e()}async function B(e){if(!o){console.error("Cannot send text: no config available");return}const t=e??"";try{if(o.inputActions)try{await d.executeActions(o.inputActions)}catch(i){console.warn("Input actions failed:",i)}const n=w(o.inputSelector);if(!n)throw new Error("Cannot find input selector");if(await S(n,t,o.inputMethod),o.sendActions)try{await d.executeActions(o.sendActions)}catch(i){console.warn("Send actions failed:",i)}if(o.sendButtonSelector){await f(100);const i=y(o.sendButtonSelector);if(i)await p(i,"click");else throw new Error("Cannot find send button")}else await p(n,"enter");u("contentReady")}catch(n){u("contentError",{type:E.SendFailed,extra:n.message}),u("logError",{error:{message:n.message,stack:n.stack},extra:{chatAppId:o.id,contentUrl:location.href,action:"sendText"}})}}async function D(e){const t=o.scrollContainerSelector!==void 0?y(o.scrollContainerSelector):C();if(!t)return e(null),null;a.scrollContainer=t;const n=b(t);if(n.scrollHeight===0||n.scrollWidth===0)return e(null),null;a.containerPosition=n,a.scrollPosition={left:t.scrollLeft,top:t.scrollTop},a.reverseScrollY=window.getComputedStyle(t).getPropertyValue("flex-direction")==="column-reverse",h({left:0,top:0}),await f(500);const i=k(),s=new Map;let c=[];i.forEach(r=>{if(!c.some(l=>l.contains(r))&&(c=c.filter(l=>!r.contains(l)),!r.contains(t)))if(t.contains(r)){const m=window.getComputedStyle(r).getPropertyValue("position");if(m==="absolute"){const g=x(r);t.contains(g)||c.push(r)}else(m==="fixed"||m==="sticky")&&c.push(r)}else c.push(r)}),c.forEach(r=>{const l=r.getAttribute("style")||"";s.set(r,l),r.setAttribute("style",l+";visibility:hidden!important;opacity:0!important;")}),await f(500),a.hiddenElementMap=s,e(n)}function h(e){let t=0;return a.reverseScrollY&&(t=a.containerPosition.scrollHeight-a.containerPosition.clientHeight),a.scrollContainer.scrollTo({left:e.left,top:e.top-t,behavior:"instant"}),{left:a.scrollContainer.scrollLeft,top:a.scrollContainer.scrollTop+t}}function F(){a.scrollContainer.scrollTo({left:a.scrollPosition.left,top:a.scrollPosition.top,behavior:"instant"}),a.hiddenElementMap.forEach((e,t)=>{t.setAttribute("style",e)})}window.self!==window.top&&((location.hostname==="claude.ai"||location.hostname.endsWith(".claude.ai"))&&chrome.runtime&&chrome.runtime.sendMessage&&chrome.runtime.sendMessage({action:"injectClaudeMain",source:"simple-chat-hub"}).catch(()=>{}),q(),A(async(e,t)=>{if(e==="sendText"&&await B(t.text),e==="newChatPreprocess"&&o&&o.newChatActions)try{await d.executeActions(o.newChatActions)}catch(n){console.warn("New chat actions failed:",n)}if(e==="getLocationHref")return window.location.href;if(e==="captureStart")return await new Promise(n=>{D(n)});if(e==="triggerScroll")return h(t);e==="captureEnd"&&F()}));
